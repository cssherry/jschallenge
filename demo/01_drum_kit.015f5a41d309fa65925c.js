(()=>{"use strict";function t(t,e,n=!1){const a=document.createElementNS("http://www.w3.org/2000/svg",e);return n?t.prepend(a):t.append(a),a}var e;function n(t){return document.querySelector(`[data-key="${t}"]`)}!function(t){t[t.Playing=0]="Playing",t[t.Fading=1]="Fading"}(e||(e={}));function a(t){let e=Number.isNaN(parseInt(t))?t.toUpperCase():t;switch(t){case"1":e="!";break;case"2":e="@";break;case"3":e="#";break;case"4":e="$";break;case"5":e="%";break;case"6":e="^";break;case"7":e="&";break;case"8":e="*";break;case"9":e="(";break;case"0":e=")"}return e}function s(e,n){const s={},i=Math.max(1,Math.floor(n.length/7)),d=i>=7?1:1+Math.floor((7-i)/2),o=t(e,"svg");let r;return o.setAttribute("height","100px"),o.setAttribute("width",35*(n.length+1)+"px"),n.forEach(((e,n)=>{const i=function(e,n,a){const s=t(e,"rect",!0);s.classList.add("key-white"),s.setAttribute("height","100px"),s.setAttribute("width","35px"),s.setAttribute("y","0"),s.setAttribute("x",n?35*n+"px":"0");const i=function(t){return 35*(t+1)}(n),d=t(e,"text");return d.classList.add("text-white"),d.setAttribute("y","85px"),d.setAttribute("x",i-15.5+"px"),d.textContent=a,s}(o,n,e),u=function(e,n,s){const i=n%7;if(0===i||3===i)return null;const d=35*n,o=t(e,"rect");o.classList.add("key-black"),o.setAttribute("height","60px"),o.setAttribute("width","22px"),o.setAttribute("y","0"),o.setAttribute("x",""+(d-11));const r=t(e,"text");return r.classList.add("text-black"),r.setAttribute("y","30px"),r.setAttribute("x",d-6.5+"px"),r.textContent=a(s),o}(o,n,r),c=d+Math.floor(n/7),l=String.fromCharCode((n+2)%7+65),v=`${l}${c}`;if(s[e]=v,i.setAttribute("data-key",e),i.setAttribute("data-pitch-key",v),"C4"===s[e]&&(t(i,"title").textContent="This is middle C (C4)"),u&&r){const t=`${l}b${c}`,e=a(r);s[e]=t,u.setAttribute("data-key",e),u.setAttribute("data-pitch-key",t)}r=e})),s}const i=document.getElementById("pressed-note"),d=document.getElementById("pressed-key"),o=document.querySelector(".display-right"),r={};function u(t,a){!t||"Shift"===t||!a[t]||r[t]&&r[t].status===e.Playing||function(t,a){var s;if(t){null===(s=n(t))||void 0===s||s.classList.add("pressed");let u=document.querySelector(`[data-pitch-key="${a[t]}"]`);r[t]?(u=u.cloneNode(!1),r[t].audios.push(u),r[t].status=e.Playing):r[t]={key:t,audios:[u],status:e.Playing,lastHandledIdx:-1},i.textContent=a[t],d.textContent=t,o.textContent+=` ${a[t]} `,u.currentTime=.1,u.play()}}(t,a)}function c(t){if(!t)return;let a;if(Object.values(r).forEach((e=>{(function(t,e){return e===t||e.startsWith(`${t}_`)||e.endsWith(`_${t}`)})(t,e.key)&&(a=e)})),a){const t=a;t.status=e.Fading,setTimeout((()=>{t.lastHandledIdx+=1;const a=t.lastHandledIdx,s=t.audios[a];s&&(i.textContent="N/A",d.textContent="N/A",s.currentTime=4,function(t){var e;null===(e=n(t))||void 0===e||e.classList.remove("pressed")}(t.key),t.status=e.Fading,setTimeout((()=>{t.audios[a]=null,t.audios.every((t=>!t))&&delete r[t.key]}),1e3))}),200)}}window.onload=()=>{const t=document.getElementById("keyboard");var e,n;e=t,n=s(t,["1","2","3","4","5","6","7","8","9","0","q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m"]),document.addEventListener("keydown",(t=>{u(t.key,n)})),e.addEventListener("mousedown",(t=>{var e,a;u(null===(a=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===a?void 0:a.key,n)})),e.addEventListener("touchstart",(t=>{var e,a;u(null===(a=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===a?void 0:a.key,n)})),document.addEventListener("keyup",(t=>{c(t.key)})),e.addEventListener("mouseup",(t=>{var e,n;c(null===(n=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===n?void 0:n.key)})),e.addEventListener("touchend",(t=>{var e,n;c(null===(n=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===n?void 0:n.key)})),e.addEventListener("touchmove",(t=>{var e,n;c(null===(n=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===n?void 0:n.key)})),e.addEventListener("touchcancel",(t=>{var e,n;c(null===(n=null===(e=t.target)||void 0===e?void 0:e.dataset)||void 0===n?void 0:n.key)}))}})();