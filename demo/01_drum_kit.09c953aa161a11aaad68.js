(()=>{"use strict";function t(t,e,s=!1){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return s?t.prepend(n):t.append(n),n}var e;function s(t){return document.querySelector(`[data-key="${t}"]`)}!function(t){t[t.Playing=0]="Playing",t[t.Fading=1]="Fading"}(e||(e={}));function n(t){let e=Number.isNaN(parseInt(t))?t.toUpperCase():t;switch(t){case"1":e="!";break;case"2":e="@";break;case"3":e="#";break;case"4":e="$";break;case"5":e="%";break;case"6":e="^";break;case"7":e="&";break;case"8":e="*";break;case"9":e="(";break;case"0":e=")"}return e}function a(e,s){const a={},i=Math.max(1,Math.floor(s.length/7)),r=i>=7?1:1+Math.floor((7-i)/2),o=t(e,"svg");o.setAttribute("height","170px"),o.setAttribute("width",35*(s.length+1)+"px");const u=document.getElementById("inset-filter");let c;return u&&o.append(u),s.forEach(((e,s)=>{const i=function(e,s,n){const a=t(e,"rect",!0);a.classList.add("key-white"),a.setAttribute("height","170px"),a.setAttribute("width","35px"),a.setAttribute("y","0"),a.setAttribute("x",s?35*s+"px":"0");const i=function(t){return 35*(t+1)}(s),r=t(e,"text");return r.classList.add("text-white"),r.setAttribute("y","155px"),r.setAttribute("x",i-15.5+"px"),r.textContent=n,a}(o,s,e),u=function(e,s,a){const i=s%7;if(0===i||3===i)return null;const r=35*s,o=t(e,"rect");o.classList.add("key-black"),o.setAttribute("height","102px"),o.setAttribute("width","22px"),o.setAttribute("y","0"),o.setAttribute("x",""+(r-11));const u=t(e,"text");return u.classList.add("text-black"),u.setAttribute("y","51px"),u.setAttribute("x",r-6.5+"px"),u.textContent=n(a),o}(o,s,c),d=r+Math.floor(s/7),l=String.fromCharCode((s+2)%7+65);if(a[e]=`${l}${d}`,i.setAttribute("data-key",e),"C4"===a[e]&&(t(i,"title").textContent="This is middle C (C4)"),u&&c){const t=`${l}b${d}`,e=n(c);a[e]=t,u.setAttribute("data-key",e)}c=e})),a}const i={};function r(t){const n=t.key;let a;if(Object.values(i).forEach((t=>{(function(t,e){return e===t||e.startsWith(`${t}_`)||e.endsWith(`_${t}`)})(n,t.key)&&(a=t)})),a){const t=a;t.status=e.Fading,setTimeout((()=>{t.lastHandledIdx+=1;const n=t.lastHandledIdx,a=t.audios[n];var r;a&&(a.currentTime=4,null===(r=s(t.key))||void 0===r||r.classList.remove("pressed"),t.status=e.Fading,setTimeout((()=>{console.log("handleIdx",n),t.audios[n]=null,t.audios.every((t=>!t))&&delete i[t.key]}),1e3))}),200)}}window.onload=()=>{const t=document.getElementById("keyboard");var n;n=a(t,["1","2","3","4","5","6","7","8","9","0","q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m"]),document.addEventListener("keydown",(t=>{!function(t,n){const a=t.key;"Shift"===a||!n[a]||i[a]&&i[a].status===e.Playing||function(t,n){var a;if(t){null===(a=s(t))||void 0===a||a.classList.add("pressed");let r=document.querySelector(`[data-pitch-key="${n[t]}"]`);i[t]?(r=r.cloneNode(!1),i[t].audios.push(r),i[t].status=e.Playing):i[t]={key:t,audios:[r],status:e.Playing,lastHandledIdx:-1},r.currentTime=.1,r.play()}}(a,n)}(t,n)})),document.addEventListener("keyup",r)}})();